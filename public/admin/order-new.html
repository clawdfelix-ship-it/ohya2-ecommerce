<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Order - OHYA2.0 Admin</title>
  <style>
    body { font-family: -apple-system, sans-serif; margin: 0; background: #f5f5f5; }
    .nav { background: #1a1a2e; padding: 10px; overflow-x: auto; white-space: nowrap; }
    .nav a { color: #fff; text-decoration: none; padding: 10px 15px; display: inline-block; font-size: 14px; }
    .main { padding: 15px; }
    .card { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    h2 { margin: 0 0 10px 0; font-size: 16px; }
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; font-size: 12px; margin-bottom: 5px; }
    .form-group select, .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    .btn { padding: 12px 24px; background: #6366f1; color: #fff; border: none; border-radius: 5px; font-size: 14px; }
    .total { font-size: 20px; font-weight: bold; text-align: right; padding: 10px; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="index.html">üìä Dashboard</a>
    <a href="orders.html">‚Üê Back to Orders</a>
  </div>
  <div class="main">
    <h2>Create New Order</h2>
    <div class="card">
      <div class="form-group">
        <label>Select Product</label>
        <select id="product" onchange="calc()"></select>
      </div>
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" id="qty" value="1" min="1" onchange="calc()">
      </div>
      <div class="form-group">
        <label>Unit Price</label>
        <input type="text" id="unit" readonly>
      </div>
      <div class="total">Total: $<span id="total">0</span></div>
    </div>
    <button class="btn" onclick="createOrder()">Create Order</button>
  </div>
  <script>
    var products = [];
    fetch('/api/products').then(function(r){return r.json();}).then(function(d){
      products = d;
      var sel = document.getElementById('product');
      d.forEach(function(p){
        sel.innerHTML += '<option value="'+p.id+'" data-price="'+p.price+'">'+(p.name||p.product_code).substring(0,30)+' - $'+p.price+'</option>';
      });
      calc();
    });
    
    function calc() {
      var sel = document.getElementById('product');
      var opt = sel.options[sel.selectedIndex];
      var price = parseInt(opt.dataset.price) || 0;
      var qty = parseInt(document.getElementById('qty').value) || 1;
      document.getElementById('unit').value = price;
      document.getElementById('total').innerText = price * qty;
    }
    
    function createOrder() {
      var pid = document.getElementById('product').value;
      var qty = parseInt(document.getElementById('qty').value) || 1;
      var total = parseInt(document.getElementById('total').innerText) || 0;
      
      fetch('/api/orders', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          total: total,
          status: 'pending',
          items: [{product_id: parseInt(pid), quantity: qty, price: total}]
        })
      }).then(function(){
        alert('Order created!');
        location.href = 'orders.html';
      });
    }
  </script>
</body>
</html>
