<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - OHYA2.0</title>
  <style>
    * { margin: 0; padding: 0; }
    body { font-family: -apple-system, sans-serif; background: #f0f2f5; }
    .sidebar { width: 180px; background: #1a1a2e; color: white; position: fixed; height: 100%; padding: 12px; }
    .sidebar h2 { color: #ec4899; margin-bottom: 15px; font-size: 16px; }
    .nav-item { display: block; padding: 10px 12px; color: #9ca3af; border-radius: 6px; cursor: pointer; margin-bottom: 2px; font-size: 13px; }
    .nav-item:hover, .nav-item.active { background: #374151; color: white; }
    .main { margin-left: 180px; padding: 15px; }
    h1 { font-size: 20px; margin-bottom: 15px; }
    .btn { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; }
    .btn-primary { background: #6366f1; color: white; }
    .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 13px; }
    .badge { padding: 3px 8px; border-radius: 12px; font-size: 11px; }
    .badge-pending { background: #fef3c7; }
    .badge-completed { background: #d1fae5; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>ğŸ›’ OHYA2</h2>
    <div class="nav-item active" onclick="show('dashboard')">ğŸ“Š Dashboard</div>
    <div class="nav-item" onclick="show('orders')">ğŸ›’ è¨‚å–®</div>
    <div class="nav-item" onclick="show('products')">ğŸ“¦ ç”¢å“</div>
    <div class="nav-item" onclick="show('customers')">ğŸ‘¥ å®¢æˆ¶</div>
    <div class="nav-item" onclick="show('settings')">âš™ï¸ è¨­å®š</div>
  </div>
  <div class="main">
    <h1 id="title">Dashboard</h1>
    <div id="content">Loading...</div>
  </div>

  <script>
    var products = [], orders = [], customers = [];
    
    // Load just counts first
    fetch('/api/analytics').then(r => r.json()).then(function(d) {
      document.getElementById('content').innerHTML = 
        '<div class="card"><b>ç¸½ç”¢å“:</b> ' + d.totalProducts + '</div>' +
        '<div class="card"><b>ç¸½è¨‚å–®:</b> ' + d.totalOrders + '</div>' +
        '<div class="card"><b>ç¸½å®¢æˆ¶:</b> ' + d.totalCustomers + '</div>';
    });
    
    function show(page) {
      document.getElementById('title').innerText = page;
      document.querySelectorAll('.nav-item').forEach(function(el) { el.classList.remove('active'); });
      event.target.classList.add('active');
      document.getElementById('content').innerText = 'Loading...';
      
      if (page === 'dashboard') loadDashboard();
      else if (page === 'orders') loadOrders();
      else if (page === 'products') loadProducts();
      else if (page === 'customers') loadCustomers();
      else if (page === 'settings') loadSettings();
    }
    
    function loadDashboard() {
      fetch('/api/analytics').then(r => r.json()).then(function(d) {
        document.getElementById('content').innerHTML = 
          '<div class="card"><b>ç¸½ç”¢å“:</b> ' + d.totalProducts + '</div>' +
          '<div class="card"><b>ç¸½è¨‚å–®:</b> ' + d.totalOrders + '</div>' +
          '<div class="card"><b>ç¸½å®¢æˆ¶:</b> ' + d.totalCustomers + '</div>' +
          '<div class="card"><b>ç¸½éŠ·å”®é¡:</b> $' + (d.totalRevenue || 0) + '</div>';
      });
    }
    
    function loadOrders() {
      fetch('/api/orders').then(r => r.json()).then(function(d) {
        orders = d;
        var html = '<button class="btn btn-primary" onclick="newOrder()">+ æ–°å¢è¨‚å–®</button><br><br><table><tr><th>ID</th><th>å®¢æˆ¶</th><th>é‡‘é¡</th><th>ç‹€æ…‹</th></tr>';
        html += orders.slice(0,20).map(function(o){ return '<tr><td>#'+o.id+'</td><td>'+(o.customer_name||'Guest')+'</td><td>$'+(o.total||0)+'</td><td><span class="badge badge-'+(o.status||'pending')+'">'+(o.status||'pending')+'</span></td></tr>'; }).join('');
        html += '</table>';
        document.getElementById('content').innerHTML = html;
      });
    }
    
    function loadProducts() {
      fetch('/api/products').then(r => r.json()).then(function(d) {
        products = d;
        var html = '<table><tr><th>ç·¨ç¢¼</th><th>åç¨±</th><th>åƒ¹æ ¼</th><th>åº«å­˜</th></tr>';
        html += products.slice(0,20).map(function(p){ return '<tr><td>'+(p.product_code||'')+'</td><td>'+(p.name||'').substring(0,20)+'</td><td>$'+(p.price||0)+'</td><td>'+(p.stock||0)+'</td></tr>'; }).join('');
        html += '</table>';
        document.getElementById('content').innerHTML = html;
      });
    }
    
    function loadCustomers() {
      fetch('/api/customers').then(r => r.json()).then(function(d) {
        customers = d;
        var html = '<table><tr><th>å§“å</th><th>Email</th><th>æ¶ˆè²»</th></tr>';
        html += customers.slice(0,20).map(function(c){ return '<tr><td>'+(c.name||'-')+'</td><td>'+(c.email||'-')+'</td><td>$'+(c.total||0)+'</td></tr>'; }).join('');
        html += '</table>';
        document.getElementById('content').innerHTML = html;
      });
    }
    
    function loadSettings() {
      document.getElementById('content').innerHTML = '<div class="card"><b>éŠ€è¡Œ:</b> æ†ç”ŸéŠ€è¡Œ 123-456789-001</div><div class="card"><b>é‹è²»:</b> å…é‹$300, å…¶ä»–$30</div>';
    }
    
    function newOrder() {
      var pid = prompt('ç”¢å“ID:');
      if (!pid) return;
      var qty = prompt('æ•¸é‡:') || 1;
      fetch('/api/products/' + pid).then(r => r.json()).then(function(p) {
        var total = (p.price || 0) * qty;
        fetch('/api/orders', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({
          total: total,
          status: 'pending',
          items: [{product_id: parseInt(pid), quantity: parseInt(qty), price: total}]
        })}).then(function() { alert('OK'); loadOrders(); });
      });
    }
  </script>
</body>
</html>
