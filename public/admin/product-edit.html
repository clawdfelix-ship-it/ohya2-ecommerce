<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç·¨è¼¯ç”¢å“ - OHYA2.0 Admin</title>
  <style>
    body { font-family: -apple-system, sans-serif; margin: 0; background: #f5f5f5; }
    .nav { background: #1a1a2e; padding: 10px; }
    .nav a { color: #fff; text-decoration: none; padding: 10px 15px; display: inline-block; font-size: 14px; }
    .main { padding: 15px; }
    .card { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 15px; }
    h2 { margin: 0 0 15px 0; font-size: 18px; }
    h3 { margin: 0 0 10px 0; font-size: 14px; color: #333; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; font-size: 12px; margin-bottom: 5px; color: #666; }
    .formform-group select,-group input, . .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
    .btn { padding: 12px 24px; background: #6366f1; color: #fff; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; }
    .btn-danger { background: #ef4444; }
    .btn-secondary { background: #9ca3af; }
    .row { display: flex; gap: 15px; }
    .col { flex: 1; }
    .info { background: #f0f7ff; padding: 10px; border-radius: 5px; font-size: 13px; color: #333; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="index.html">ğŸ“Š ç¸½è¦½</a>
    <a href="products.html">â† è¿”å›ç”¢å“</a>
  </div>
  <div class="main">
    <h2>ğŸ“¦ ç·¨è¼¯ç”¢å“</h2>
    
    <div class="card">
      <h3>ç”¢å“è³‡è¨Š</h3>
      <input type="hidden" id="product-id">
      
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label>ç”¢å“ç·¨ç¢¼</label>
            <input type="text" id="p-code">
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label>åˆ†é¡</label>
            <select id="p-category">
              <option value="ã‚ªãƒŠãƒ›ãƒ¼ãƒ«">ã‚ªãƒŠãƒ›ãƒ¼ãƒ«</option>
              <option value="ãƒ€ãƒƒãƒãƒ¯ã‚¤ãƒ•">ãƒ€ãƒƒãƒãƒ¯ã‚¤ãƒ•</option>
              <option value="ãŠã£ã±ã„ã‚°ãƒƒã‚º">ãŠã£ã±ã„ã‚°ãƒƒã‚º</option>
              <option value="æ€§æ„Ÿã‚¯ãƒƒã‚·ãƒ§ãƒ³">æ€§æ„Ÿã‚¯ãƒƒã‚·ãƒ§ãƒ³</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>ç”¢å“åç¨±</label>
        <input type="text" id="p-name">
      </div>
      
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label>æˆæœ¬ (æ—¥å…ƒ JPY)</label>
            <input type="number" id="p-price-jpy">
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label>å”®åƒ¹ (æ¸¯å¹£ HKD)</label>
            <input type="number" id="p-price-hkd" readonly style="background:#f9f9f9">
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label>åº«å­˜æ•¸é‡</label>
            <input type="number" id="p-stock">
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label>ç‹€æ…‹</label>
            <select id="p-active">
              <option value="1">ä¸Šæ¶ä¸­</option>
              <option value="0">ä¸‹æ¶</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>åœ–ç‰‡ URL</label>
        <input type="text" id="p-image">
      </div>
      
      <div class="form-group">
        <label>æè¿°</label>
        <textarea id="p-desc" rows="3"></textarea>
      </div>
      
      <div class="info">
        ğŸ’¡ å”®åƒ¹æœƒæ ¹æ“šåŒ¯ç‡è‡ªå‹•ç”±æ—¥å…ƒè½‰æ›
      </div>
    </div>
    
    <div style="display:flex;gap:10px;">
      <button class="btn" onclick="saveProduct()">ğŸ’¾ å„²å­˜è®Šæ›´</button>
      <button class="btn btn-danger" onclick="deleteProduct()">ğŸ—‘ï¸ åˆªé™¤ç”¢å“</button>
    </div>
  </div>
  
  <script>
    var productId = new URLSearchParams(window.location.search).get('id');
    var product = {};
    
    if(!productId) {
      alert('æ²’æœ‰ç”¢å“ID');
      location.href = 'products.html';
    }
    
    document.getElementById('product-id').value = productId;
    
    // Load product
    fetch('/api/products/' + productId).then(function(r){return r.json();}).then(function(p){
      product = p;
      document.getElementById('p-code').value = p.product_code || '';
      document.getElementById('p-name').value = p.name || '';
      document.getElementById('p-category').value = p.category || 'ã‚ªãƒŠãƒ›ãƒ¼ãƒ«';
      document.getElementById('p-price-jpy').value = p.price_jpy || p.price || 0;
      document.getElementById('p-price-hkd').value = p.price || 0;
      document.getElementById('p-stock').value = p.stock || 0;
      document.getElementById('p-active').value = p.active === 0 ? '0' : '1';
      document.getElementById('p-image').value = p.image_url || '';
      document.getElementById('p-desc').value = p.description || '';
    });
    
    // Calculate HKD when JPY changes
    document.getElementById('p-price-jpy').addEventListener('input', function(){
      var jpy = parseInt(this.value) || 0;
      var hkd = Math.round(jpy * 0.053); // 1 JPY â‰ˆ 0.053 HKD
      document.getElementById('p-price-hkd').value = hkd;
    });
    
    function saveProduct() {
      var jpy = parseInt(document.getElementById('p-price-jpy').value) || 0;
      var hkd = Math.round(jpy * 0.053);
      
      var data = {
        product_code: document.getElementById('p-code').value,
        name: document.getElementById('p-name').value,
        category: document.getElementById('p-category').value,
        price: hkd, // Store in HKD
        price_jpy: jpy, // Also store original JPY
        stock: parseInt(document.getElementById('p-stock').value) || 0,
        active: parseInt(document.getElementById('p-active').value),
        image_url: document.getElementById('p-image').value,
        description: document.getElementById('p-desc').value
      };
      
      fetch('/api/products/' + productId, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      }).then(function(){
        alert('ç”¢å“å·²æ›´æ–°ï¼');
        location.href = 'products.html';
      }).catch(function(e){
        alert('éŒ¯èª¤: ' + e.message);
      });
    }
    
    function deleteProduct() {
      if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç”¢å“å—ï¼Ÿ')) {
        fetch('/api/products/' + productId, {
          method: 'DELETE'
        }).then(function(){
          alert('ç”¢å“å·²åˆªé™¤');
          location.href = 'products.html';
        });
      }
    }
  </script>
</body>
</html>
