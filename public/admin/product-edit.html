<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç·¨è¼¯ç”¢å“ - OHYA2.0 Admin</title>
  <style>
    body { font-family: -apple-system, sans-serif; margin: 0; background: #f5f5f5; }
    .nav { background: #1a1a2e; padding: 10px; }
    .nav a { color: #fff; text-decoration: none; padding: 10px 15px; display: inline-block; font-size: 14px; }
    .main { padding: 15px; }
    .card { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 15px; }
    h2 { margin: 0 0 15px 0; font-size: 18px; }
    h3 { margin: 0 0 10px 0; font-size: 14px; color: #333; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; font-size: 12px; margin-bottom: 5px; color: #666; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; box-sizing: border-box; }
    textarea { resize: vertical; }
    .btn { padding: 12px 24px; background: #6366f1; color: #fff; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; }
    .btn-small { padding: 8px 16px; font-size: 13px; }
    .btn-danger { background: #ef4444; }
    .btn-success { background: #22c55e; }
    .btn-secondary { background: #6b7280; }
    .row { display: flex; gap: 15px; }
    .col { flex: 1; }
    .col-3 { flex: 3; }
    .price-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    .price-row { display: flex; gap: 10px; margin-bottom: 10px; }
    .price-field { flex: 1; }
    .price-field label { font-size: 11px; }
    .price-field input { padding: 8px; }
    .info { background: #e8f5e9; padding: 10px; border-radius: 5px; font-size: 13px; color: #333; }
    .seo-box { background: #fffbeb; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #fcd34d; }
    .variant-box { background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #7dd3fc; }
    .variant-list { margin-top: 10px; }
    .variant-item { display: flex; gap: 10px; align-items: center; background: #fff; padding: 10px; border-radius: 5px; margin-bottom: 8px; }
    .variant-item input { flex: 1; padding: 8px; }
    .variant-item .btn-small { padding: 8px 12px; }
    .image-preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .image-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; }
    .image-url-item { display: flex; gap: 10px; margin-bottom: 8px; }
    .image-url-item input { flex: 1; }
    .help-text { font-size: 11px; color: #888; margin-top: 3px; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="index.html">ğŸ“Š ç¸½è¦½</a>
    <a href="categories.html">ğŸ·ï¸ åˆ†é¡</a>
    <a href="products.html">â† è¿”å›ç”¢å“</a>
  </div>
  <div class="main">
    <h2>ğŸ“¦ ç·¨è¼¯ç”¢å“</h2>
    
    <div class="card">
      <h3>ç”¢å“è³‡è¨Š</h3>
      <input type="hidden" id="product-id">
      
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label>ç”¢å“ç·¨ç¢¼</label>
            <input type="text" id="p-code">
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label>JAN Code (æ¢ç¢¼)</label>
            <input type="text" id="p-jan" placeholder="1234567890123">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>ç”¢å“åç¨±</label>
        <input type="text" id="p-name">
      </div>

      <div class="form-group">
        <label>åˆ†é¡</label>
        <select id="p-category">
          <option value="ã‚ªãƒŠãƒ›ãƒ¼ãƒ«">ã‚ªãƒŠãƒ›ãƒ¼ãƒ«</option>
          <option value="ãƒ€ãƒƒãƒãƒ¯ã‚¤ãƒ•">ãƒ€ãƒƒãƒãƒ¯ã‚¤ãƒ•</option>
          <option value="ãŠã£ã±ã„ã‚°ãƒƒã‚º">ãŠã£ã±ã„ã‚°ãƒƒã‚º</option>
          <option value="æ€§æ„Ÿã‚¯ãƒƒã‚·ãƒ§ãƒ³">æ€§æ„Ÿã‚¯ãƒƒã‚·ãƒ§ãƒ³</option>
        </select>
      </div>
      
      <!-- 3å±¤åƒ¹æ ¼ -->
      <div class="price-box">
        <h3>ğŸ’° åƒ¹æ ¼è¨­å®š (æ—¥å…ƒ JPY)</h3>
        <div class="price-row">
          <div class="price-field">
            <label>æˆæœ¬åƒ¹ (Cost)</label>
            <input type="number" id="p-price-cost" placeholder="0">
          </div>
          <div class="price-field">
            <label>é›¶å”®åƒ¹ (Retail)</label>
            <input type="number" id="p-price-retail" placeholder="0">
          </div>
          <div class="price-field">
            <label>æ‰¹ç™¼åƒ¹ (Wholesale)</label>
            <input type="number" id="p-price-wholesale" placeholder="0">
          </div>
        </div>
        <div class="info">
          ğŸ’¡ ç³»çµ±æœƒè‡ªå‹•å°‡æ—¥å…ƒè½‰æ›ç‚ºæ¸¯å…ƒé¡¯ç¤º (1 HKD â‰ˆ 19 JPY)
        </div>
      </div>
      
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label>åº«å­˜æ•¸é‡</label>
            <input type="number" id="p-stock">
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label>ç‹€æ…‹</label>
            <select id="p-active">
              <option value="1">ä¸Šæ¶ä¸­</option>
              <option value="0">ä¸‹æ¶</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- ä¸»è¦åœ–ç‰‡ -->
      <div class="form-group">
        <label>ä¸»è¦åœ–ç‰‡ URL</label>
        <input type="text" id="p-image" placeholder="https://example.com/image.jpg">
      </div>
      
      <!-- å¤šåœ–ä¸Šå‚³ -->
      <div class="form-group">
        <label>ğŸ“· æ›´å¤šåœ–ç‰‡ (å¤šå€‹URLï¼Œä¸€è¡Œä¸€å€‹)</label>
        <textarea id="p-images" rows="4" placeholder="https://example.com/image1.jpg&#10;https://example.com/image2.jpg&#10;https://example.com/image3.jpg"></textarea>
        <div class="help-text">è¼¸å…¥å¤šå€‹åœ–ç‰‡URLï¼Œæ¯è¡Œä¸€å€‹</div>
      </div>
      
      <div class="form-group">
        <label>æè¿°</label>
        <textarea id="p-desc" rows="3"></textarea>
      </div>
    </div>
    
    <!-- ç”¢å“è®Šé«” -->
    <div class="card variant-box">
      <h3>ğŸ¨ ç”¢å“è®Šé«” (é¡è‰²/å°ºå¯¸)</h3>
      <div class="variant-list" id="variant-list">
        <!-- Variants will be loaded here -->
      </div>
      <div style="margin-top: 10px;">
        <button class="btn btn-success btn-small" onclick="addVariant()">+ æ·»åŠ è®Šé«”</button>
      </div>
    </div>
    
    <!-- SEO è¨­å®š -->
    <div class="card seo-box">
      <h3>ğŸ” SEO è¨­å®š</h3>
      <div class="form-group">
        <label>SEO æ¨™é¡Œ (Meta Title)</label>
        <input type="text" id="p-seo-title" placeholder="ç”¢å“æ¨™é¡Œ - ç¶²åº—åç¨±">
        <div class="help-text">å»ºè­°é•·åº¦: 50-60å€‹å­—ç¬¦</div>
      </div>
      <div class="form-group">
        <label>SEO æè¿° (Meta Description)</label>
        <textarea id="p-seo-desc" rows="2" placeholder="ç”¢å“æè¿°æ‘˜è¦..."></textarea>
        <div class="help-text">å»ºè­°é•·åº¦: 150-160å€‹å­—ç¬¦</div>
      </div>
      <div class="form-group">
        <label>SEO é—œéµå­— (Keywords)</label>
        <input type="text" id="p-seo-keywords" placeholder="é—œéµå­—1, é—œéµå­—2, é—œéµå­—3">
      </div>
    </div>
    
    <div style="display:flex;gap:10px;">
      <button class="btn" onclick="saveProduct()">ğŸ’¾ å„²å­˜è®Šæ›´</button>
      <button class="btn btn-danger" onclick="deleteProduct()">ğŸ—‘ï¸ åˆªé™¤ç”¢å“</button>
    </div>
  </div>
  
  <script>
    var productId = new URLSearchParams(window.location.search).get('id');
    var productData = {};
    var variants = [];
    
    if(!productId) {
      alert('æ²’æœ‰ç”¢å“ID');
      location.href = 'products.html';
    }
    
    document.getElementById('product-id').value = productId;
    
    // Load product
    fetch('/api/products/' + productId).then(function(r){return r.json();}).then(function(p){
      productData = p;
      document.getElementById('p-code').value = p.product_code || '';
      document.getElementById('p-jan').value = p.jan_code || '';
      document.getElementById('p-name').value = p.name || '';
      document.getElementById('p-category').value = p.category || 'ã‚ªãƒŠãƒ›ãƒ¼ãƒ«';
      document.getElementById('p-price-cost').value = p.price_cost || 0;
      document.getElementById('p-price-retail').value = p.price_retail || 0;
      document.getElementById('p-price-wholesale').value = p.price_wholesale || 0;
      document.getElementById('p-stock').value = p.stock || 0;
      document.getElementById('p-active').value = p.active === 0 ? '0' : '1';
      document.getElementById('p-image').value = p.image_url || '';
      
      // Multiple images
      var images = p.image_urls || [];
      document.getElementById('p-images').value = images.join('\n');
      
      document.getElementById('p-desc').value = p.description || '';
      
      // SEO fields
      document.getElementById('p-seo-title').value = p.seo_title || '';
      document.getElementById('p-seo-desc').value = p.seo_description || '';
      document.getElementById('p-seo-keywords').value = p.seo_keywords || '';
      
      // Load variants
      variants = p.variants || [];
      renderVariants();
    });
    
    function renderVariants() {
      var container = document.getElementById('variant-list');
      container.innerHTML = '';
      
      variants.forEach(function(v, index) {
        var div = document.createElement('div');
        div.className = 'variant-item';
        div.innerHTML = '<input type="text" placeholder="é¡å‹ (å¦‚: é¡è‰²)" value="' + (v.variant_name || '') + '" onchange="updateVariant(' + index + ', \'variant_name\', this.value)"><input type="text" placeholder="å€¼ (å¦‚: ç´…è‰²)" value="' + (v.variant_value || '') + '" onchange="updateVariant(' + index + ', \'variant_value\', this.value)"><input type="text" placeholder="SKU" value="' + (v.sku || '') + '" onchange="updateVariant(' + index + ', \'sku\', this.value)"><input type="number" placeholder="åº«å­˜" value="' + (v.stock || 0) + '" style="width:80px" onchange="updateVariant(' + index + ', \'stock\', this.value)"><button class="btn btn-danger btn-small" onclick="removeVariant(' + index + ')">âœ•</button>';
        container.appendChild(div);
      });
    }
    
    function addVariant() {
      variants.push({ variant_name: '', variant_value: '', sku: '', stock: 0, price_modifier: 0 });
      renderVariants();
    }
    
    function updateVariant(index, field, value) {
      variants[index][field] = field === 'stock' || field === 'price_modifier' ? parseInt(value) || 0 : value;
    }
    
    function removeVariant(index) {
      variants.splice(index, 1);
      renderVariants();
    }
    
    function saveProduct() {
      // Parse multiple images
      var imagesText = document.getElementById('p-images').value;
      var imageUrls = imagesText.split('\n').map(function(url) { return url.trim(); }).filter(function(url) { return url.length > 0; });
      
      var data = {
        product_code: document.getElementById('p-code').value,
        jan_code: document.getElementById('p-jan').value,
        name: document.getElementById('p-name').value,
        category: document.getElementById('p-category').value,
        price_cost: parseInt(document.getElementById('p-price-cost').value) || 0,
        price_retail: parseInt(document.getElementById('p-price-retail').value) || 0,
        price_wholesale: parseInt(document.getElementById('p-price-wholesale').value) || 0,
        stock: parseInt(document.getElementById('p-stock').value) || 0,
        active: parseInt(document.getElementById('p-active').value),
        image_url: document.getElementById('p-image').value,
        image_urls: imageUrls,
        description: document.getElementById('p-desc').value,
        seo_title: document.getElementById('p-seo-title').value,
        seo_description: document.getElementById('p-seo-desc').value,
        seo_keywords: document.getElementById('p-seo-keywords').value,
        variants: variants
      };
      
      fetch('/api/products/' + productId, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      }).then(function(){
        alert('ç”¢å“å·²æ›´æ–°ï¼');
        location.href = 'products.html';
      }).catch(function(e){
        alert('éŒ¯èª¤: ' + e.message);
      });
    }
    
    function deleteProduct() {
      if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç”¢å“å—ï¼Ÿ')) {
        fetch('/api/products/' + productId, {
          method: 'DELETE'
        }).then(function(){
          alert('ç”¢å“å·²åˆªé™¤');
          location.href = 'products.html';
        });
      }
    }
  </script>
</body>
</html>
